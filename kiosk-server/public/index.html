<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kiosk Admin</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="kiosk-container">
        <header class="kiosk-header">
            <h1 id="kiosk-title">Kiosk Admin</h1>
            <div class="header-actions">
                <button id="btn-open-client" class="btn" title="Open client view in a new tab">Open Client</button>
                <button id="btn-copy-client" class="btn" title="Copy client URL to clipboard">Copy Client Link</button>
                <button id="btn-toggle-theme" class="btn" title="Toggle dark mode">Dark Mode</button>
            </div>
            <div style="display:flex; align-items:center; gap:12px;">
                <div id="sse-status" class="status-badge" title="Server-Sent Events connection">
                    <span id="sse-dot" class="status-dot err"></span>
                    <span id="sse-text">Disconnected</span>
                </div>
                <div id="current-time" class="time-display"></div>
            </div>
        </header>
        <!-- Top navigation for SPA sections -->
        <nav class="kiosk-nav">
            <a href="#control" class="nav-btn" data-section="control">Control</a>
            <a href="#heartbeat" class="nav-btn" data-section="heartbeat">Heartbeat</a>
            <a href="#devices" class="nav-btn" data-section="devices">Devices</a>
            <a href="#network" class="nav-btn" data-section="network">Network</a>
            <a href="#client" class="nav-btn" data-section="client">Client</a>
        </nav>
        
        <main class="kiosk-content">
            <div id="control-panel" class="content-panel">
                <h2>Control Panel</h2>
                <div class="admin-row">
                    <input id="admin-url" type="text" placeholder="Enter a URL to display" />
                    <button id="btn-apply-url">Switch URL</button>
                    <div class="spacer"></div>
                    <button id="btn-download-client" title="Download a client setup script prefilled with this server address">Download start-kiosk.sh</button>
                </div>

            <div class="content-panel" id="hb-panel">
                <div class="panel-header">
                    <h2>Heartbeat Clients</h2>
                    <div class="panel-actions">
                        <button id="btn-refresh-hb">Refresh</button>
                    </div>
                </div>
                <div class="admin-row" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;">
                    <input id="hb-target" type="text" placeholder="Target key (id or IP)" style="min-width:240px;" />
                    <input id="hb-cmd-type" type="text" placeholder="Command type (e.g., reboot, update)" style="min-width:220px;" />
                    <input id="hb-cmd-payload" type="text" placeholder='Payload JSON (e.g., {"url":"..."})' style="min-width:320px; flex:1;" />
                    <button id="btn-send-hb-cmd">Send Command</button>
                </div>
                <div id="hb-list" class="devices-list-container">
                    <p>No heartbeat clients yet.</p>
                </div>
                <div id="hb-result" class="info-box" style="display:none; margin-top:0.5rem;"></div>
            </div>

            <div class="content-panel" id="deploy-panel">
                <div class="panel-header">
                    <h2>Deploy to Clients</h2>
                </div>
                <div class="admin-row" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                    <input id="deploy-username" type="text" placeholder="SSH Username (e.g., student)" style="min-width:200px;" />
                    <input id="deploy-password" type="password" placeholder="SSH Password (optional if using key)" style="min-width:240px;" />
                    <input id="deploy-server-base" type="text" placeholder="Server Base (e.g., http://192.168.0.10:4000)" style="min-width:320px; flex:1;" />
                </div>
                <div class="admin-row" style="display:flex; gap:0.5rem; flex-wrap:wrap; margin-top:0.5rem;">
                    <textarea id="deploy-hosts" placeholder="Enter kiosk IP addresses here (one per line)." rows="3" style="width:100%;"></textarea>
                </div>
                <div class="info-note" style="margin-top: 0.25rem; font-size: 0.8rem; text-align: center;">
                    For best results, provide a specific list of kiosk IPs. Leaving this empty will scan the entire network.
                </div>
                <div class="admin-row secondary-controls" style="display:flex; gap:1rem; align-items:center; margin-top:0.5rem;">
                    <label><input type="checkbox" id="deploy-run-setup" /> Run first-time setup</label>
                    <label><input type="checkbox" id="deploy-reboot" /> Reboot after deploy</label>
                    <div class="spacer"></div>
                    <button id="btn-deploy">Deploy</button>
                </div>
                <div id="deploy-result" class="info-box" style="display:none; margin-top:1rem;"></div>
            </div>

            <div class="content-panel" id="restart-panel">
                <div class="panel-header">
                    <h2>Restart Clients</h2>
                </div>
                <div class="admin-row" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                    <input id="restart-username" type="text" placeholder="SSH Username" style="min-width:200px;" />
                    <input id="restart-password" type="password" placeholder="SSH Password" style="min-width:240px;" />
                </div>
                <div class="admin-row" style="display:flex; gap:0.5rem; flex-wrap:wrap; margin-top:0.5rem;">
                    <textarea id="restart-hosts" placeholder="Enter kiosk IP addresses to restart (one per line)." rows="3" style="width:100%;"></textarea>
                </div>
                <div class="info-note" style="margin-top: 0.25rem; font-size: 0.8rem; text-align: center;">
                    Leave hosts empty to restart all discovered kiosks on the network.
                </div>
                <div class="admin-row secondary-controls" style="display:flex; gap:1rem; align-items:center; margin-top:0.5rem;">
                    <div class="spacer"></div>
                    <button id="btn-restart">Restart Clients</button>
                </div>
                <div id="restart-result" class="info-box" style="display:none; margin-top:1rem;"></div>
            </div>
                <div class="admin-row secondary-controls">
                    <button id="btn-reload">Reload Frame</button>
                    <label class="switch">
                        <input type="checkbox" id="toggle-blackout" />
                        <span>Blackout</span>
                    </label>
                    <div class="spacer"></div>
                    <input id="admin-token" type="password" placeholder="Admin Token" />
                </div>
            </div>

            <div class="content-panel" id="devices-panel">
                <div class="panel-header">
                    <h2>Connected Devices</h2>
                    <div class="panel-actions" style="display:flex; gap:8px; align-items:center;">
                        <input id="devices-filter" type="text" placeholder="Filter (IP, hostname, id)" style="min-width:220px;" />
                        <button id="btn-refresh-devices">Refresh</button>
                    </div>
                </div>
                <div id="devices-list" class="devices-list-container">
                    <!-- Device list will be rendered here by JavaScript -->
                    <p>Loading devices...</p>
                </div>
            </div>

            <div class="content-panel" id="lan-panel">
                <div class="panel-header">
                    <h2>Network Devices</h2>
                    <div class="panel-actions">
                        <label for="scan-mode" style="margin-right:6px;">Mode</label>
                        <select id="scan-mode" style="margin-right:10px;">
                            <option value="fast" selected>Fast</option>
                            <option value="detailed">Detailed</option>
                            <option value="aggressive">Aggressive</option>
                        </select>
                        <input id="scan-subnet" type="text" placeholder="Subnet (e.g., 192.168.0.0/24)" style="min-width:220px; margin-right:8px;" />
                        <input id="scan-ports" type="text" placeholder="Ports (e.g., 22,80,443 or 1-1000)" style="min-width:220px; margin-right:8px;" />
                        <button id="btn-show-interfaces">Interfaces</button>
                        <button id="btn-scan-lan">Scan Network</button>
                    </div>
                </div>
                <div id="lan-interfaces" class="devices-list-container hidden"></div>
                <div id="lan-results" class="devices-list-container">
                    <p>Click <strong>Scan Network</strong> to discover devices on your LAN.</p>
                </div>
            </div>

            <div id="stage" class="kiosk-stage">
                <div id="preview-controls">
                    <button id="btn-open-url">Open Current URL</button>
                    <p id="current-url-display">URL not set</p>
                </div>
                <!-- Kiosk content frame (used for client view and admin preview) -->
                <iframe id="kiosk-frame" title="Kiosk Frame" src="about:blank" style="width:100%; height:60vh; border:1px solid #ddd; border-radius:6px; background:#fff;"></iframe>
                <div id="blackout-overlay" class="blackout hidden"></div>
                <!-- Action buttons for client view (non-intrusive) -->
                <div id="client-actions" class="client-actions hidden">
                    <button id="home-button" class="action-btn" title="Return to Home Page">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                    </button>
                    <button id="restart-button" class="action-btn action-btn-warning" title="Restart Device">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                    </button>
                    <button id="shutdown-button" class="action-btn action-btn-danger" title="Shutdown Device">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                            <line x1="12" y1="2" x2="12" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

        </main>
        
        <footer class="kiosk-footer">
            <p id="kiosk-footer"> 2023 Kiosk System</p>
        </footer>
    </div>

    <div id="toast-root" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    <script src="/js/main.js"></script>
</body>
</html>
